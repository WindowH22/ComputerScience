TCP 통신과정에서 데이터를 전송하기 위해서는 가상의 통신로를 확보해야 합니다.

그 가상의 통신로를 확보하기 위해서 3 way handsahake를 거치게 됩니다.

여기서 TCP헤더의 플래그(코드 비트)가 중요한 역할을 합니다.

해당 플래그를 확대해서 보면 각 1브트로 구성된 URG,ACK, PSH, RST, SYN, FIN이라는 비트들이 각각 1비트로 구성됩니다.
![img_1.png](img_1.png)
**약자로 표현됩니다.**

- **URG** : Urgent
- **ACK** : Acknowledgement
- **PSH**: Push
- **RST**: Reset
- **SYN**: Synchronize
- **Fin**: Finish

컴퓨터 A와 B가 있다고 가정해보겠습니다.

## 3-way hand shake

1. 통신을 하기위해 A가 B에게 통신을 하기 위한 ‘연결’ 확립을 해달라고 **요청**(SYN)합니다.
- 이때 SYN 비트가 활성화되어 1로 바뀐 세그먼트를 전송합니다.

![img.png](img.png)

1. 그럼 B는 A가 보낸 요청을 받고 응답할게! 라고 응답을 회신하기위해 연결확립에 대한 ‘응답(ACK)’를 보냅니다. 동시에 B도 A에게 데이터 전송에 대한 허가를 받기 위해 연결을 확립해달라고 요청(Syn)합니다.
- 이때 SYN 비트와 ACK 비트가 활성화된 세그먼트를 전송하게 됩니다.

![img_2.png](img_2.png)

1. 그럼 B의 요청을 받은 A도 연결확립에 대한 응답(ACK)를 보냅니다.
- ACK비트가 1로 활성화된 세그먼트를 전송합니다.

![img_3.png](img_3.png)

이와 같이 TCP는 연결을 확립하기 위해  패킷 요청을 세 번 교환하는 과정을 거치게 됩니다.

이를 **3-way handshake**라고 합니다.

이제 연결을 종료하는 과정을 알아봅시다.

## 4-way handshake

TCP는 연결을 종료할 때도 확인 작업을 거칩니다.

연결을 종료할 때는 **FIN** 와 **ACK** 비트를 사용합니다.

1. A는 B에게 연결 종료를 요청합니다.
- FIN이 1로 활성화된 세그먼트를 전송하게 됩니다.

![img_4.png](img_4.png)

1. B는 A에게 연결 종료에 대한 응답을 반환합니다.
- ACK가 1로 활성화된 세그먼트를 전송하게 됩니다.

![img_5.png](img_5.png)

1. B도 A에게 연결 종료를 요청합니다.
- FIN이 1로 활성화된 세그먼트를 전송하게 됩니다.

![img_6.png](img_6.png)

1. A도 B에게 연결종료에 대한 응답을 반환합니다.
- ACK가 1로 활성화된 세그먼트를 전송하게 됩니다.

![img_7.png](img_7.png)

이와 같이 TCP는 연결을 종료하기 위해  패킷 요청을 네 번 교환하는 과정을 거치게 됩니다.

이를 **4-way handshake**라고 합니다.